import{D as U,d as ge,L as me,a as xe,C as fe,r as c,j as e,B as T,T as J,b as p,c as b,e as E,f as C,I,O as u,g as pe,h as je,i as ve,S as Te,k as F,l as w,m as q,n as y,F as ye,o as Se,p as R,q as X,G as Ce,s as Ie,t as we,u as be,v as Ee,w as H,x as D,y as k,z as Fe,A as He,E as Oe,H as De,J as z,K as ke,M as Re,N as Ae,R as Me,P as Pe}from"./vendor-77f71cf8.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function r(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=r(i);fetch(i.href,a)}})();const Le={hours:60,minutes:1};function _e(t,n,r){const s=Z(n,r);return t.plusMinutes(s)}function Z(t,n){return Le[t]*n}function Ne(t,n,r){const s=me.of(xe.ofEpochDay(0),t),i=Z(n,r),a=s.plusMinutes(i);return fe.DAYS.between(s.toLocalDate(),a.toLocalDate())}function Q(t,n){return n.isBefore(t)?1:0}var j=(t=>(t.H12="24h",t.H24="12h",t))(j||{});const Ge=U.ofPattern("h:mm[ ]a").withLocale(ge.Locale.US),Be=U.ofPattern("H:mm");function ze(t){return t==="12h"?Be:Ge}function Ve({time:t,isEditable:n,formatter:r,onTimeChange:s,integrateWithCalendar:i,changeDateOnTextInput:a}){const o=t.format(r),[l,h]=c.useState(o),[g,d]=c.useState("");c.useEffect(()=>{h(t.format(r))},[t,r]);function x(f){const S=f.target.value;if(h(S),i&&a)try{Q(t,V(S,r))!==0?d("Date will be set to tomorrow"):d("")}catch{d("")}}function m(){try{const f=V(l,r);s(f),d("")}catch{h(t.format(r))}}function v(f){f.key==="Enter"&&f.target.blur()}return e.jsx(e.Fragment,{children:n?e.jsx(T,{display:"flex",justifyContent:"center",alignItems:"center",children:e.jsx(J,{variant:"standard",value:l,sx:{marginBottom:"16px",width:"210px","& input":{textAlign:"center",fontSize:"3rem"}},onChange:x,onBlur:m,onKeyDown:v,helperText:g})}):e.jsx(p,{variant:"h3",align:"center",color:"text.primary",children:o})})}function V(t,n){const r=t.toUpperCase();return b.parse(r,n)}const $="v1.1.1 (dev build)",ee="dev.vijexa.owlclock/changelogModal",te="dev.vijexa.owlclock/infoModal",A="dev.vijexa.owlclock/settingsModal";function We({isGm:t,lastReadChangelogVersion:n}){const r=n==="1.1.1";return e.jsxs(e.Fragment,{children:[e.jsx(E,{title:"OwlClockðŸ¦‰ (dev)",titleTypographyProps:{sx:{fontSize:"1.125rem",fontWeight:"bold",lineHeight:"32px",color:"text.primary"}},action:e.jsxs(e.Fragment,{children:[e.jsx(C,{arrow:!0,title:"Changelog",children:e.jsx(I,{onClick:()=>u.modal.open({id:ee,url:"/#/changelog",hidePaper:!0,fullScreen:!0}),children:e.jsx(pe,{color:"primary",variant:"dot",invisible:r,children:e.jsx(je,{})})})}),e.jsx(C,{arrow:!0,title:"Information",children:e.jsx(I,{onClick:()=>u.modal.open({id:te,url:"/#/info",hidePaper:!0,fullScreen:!0}),children:e.jsx(ve,{})})}),e.jsx(C,{arrow:!0,title:"Settings",children:e.jsx(I,{onClick:()=>u.modal.open({id:A,url:"/#/settings?isGm="+t,hidePaper:!0,fullScreen:!0}),children:e.jsx(Te,{})})})]})}),e.jsx(F,{variant:"middle"})]})}function Ye({history:t,onTimeChange:n,onFavorite:r}){return e.jsx(e.Fragment,{children:e.jsx(w,{direction:"row",alignItems:"center",justifyContent:"center",flexWrap:"wrap",useFlexGap:!0,spacing:1,children:t.map((s,i)=>e.jsxs(q,{size:"small",variant:"outlined",children:[e.jsxs(y,{sx:{width:"fit-content"},onClick:()=>n(s.unit,s.inputValue),children:[s.inputValue," ",s.unit[0]]}),e.jsx(y,{variant:s.isFavorite?"contained":"outlined",onClick:()=>r(i,!s.isFavorite),children:e.jsx(ye,{fontSize:"small"})})]},i))})})}function Ke({onTimeChange:t}){const[n,r]=c.useState("1"),[s,i]=c.useState("1"),a=l=>()=>{t(l,parseInt(n))};function o(){const l=parseInt(n);if(isNaN(l)||l===0)r(s);else{const h=l.toString();i(h),r(h)}}return e.jsx(e.Fragment,{children:e.jsxs(w,{direction:"row",alignItems:"center",justifyContent:"center",flexWrap:"wrap",rowGap:"8px",spacing:1,children:[e.jsx(J,{id:"outlined-basic",variant:"outlined",type:"number",size:"small",label:"Add",sx:{width:"80px"},value:n,onChange:l=>r(l.target.value),onBlur:o}),e.jsxs(q,{variant:"outlined",children:[e.jsx(y,{onClick:a("hours"),children:"Hours"}),e.jsx(y,{onClick:a("minutes"),children:"Minutes"})]})]})})}const ne="lastReadChangelogVersion";function re(){return localStorage.getItem(ne)??""}function Ue(t){localStorage.setItem(ne,t)}const se="timeFormat",ie="historySize",ae="integrateWithCalendar",oe="changeDateOnTextInput",le="favorites";function M(){const t=localStorage.getItem(se);if(t===j.H12||t===j.H24)return t;{const n=navigator.language;return Intl.DateTimeFormat(n,{hour:"numeric"}).resolvedOptions().hour12?j.H12:j.H24}}function P(){const t=localStorage.getItem(ie);if(t){const n=parseInt(t);if(!isNaN(n))return n}return 5}function Je(){const t=localStorage.getItem(le);if(t)try{const n=JSON.parse(t);if(Array.isArray(n))return n}catch{return[]}return[]}function L(){return localStorage.getItem(ae)==="true"}function _(){return localStorage.getItem(oe)==="true"}function qe(t){localStorage.setItem(le,JSON.stringify(t))}function Xe(t,n,r,s){localStorage.setItem(se,t),localStorage.setItem(ie,n.toString()),localStorage.setItem(ae,r.toString()),localStorage.setItem(oe,s.toString())}const N="dev.vijexa.owlclock/time",Ze="com.battle-system.calendar-integrate/data";function ce(t,n,r){const s={[N]:{time:t.toString(),verificationTimestamp:Date.now()}};return r?u.room.setMetadata({...s,[Ze]:{Increment:n,Timestamp:Date.now()}}):u.room.setMetadata(s)}function Qe(){const[t,n]=c.useState(b.parse("00:00")),[r,s]=c.useState(0),[i,a]=c.useState([]),[o,l]=c.useState(!1),[h,g]=c.useState(M()),[d,x]=c.useState(P()),[m,v]=c.useState(L()),[f,S]=c.useState(_()),[de,ue]=c.useState(re());c.useEffect(()=>st(n,a,l,g,x,v,S,ue),[]);const O=ze(h);c.useEffect(()=>rt(t,r,s,n,O),[t,r,O]);const B=nt(t,i,a,d,m),he=tt(t,m,f);return e.jsxs(w,{id:"mainContainer",direction:"column",height:"100vh",children:[e.jsx(We,{isGm:o,lastReadChangelogVersion:de}),e.jsxs(w,{direction:"column",spacing:2,sx:{padding:"16px",overflowY:"auto",flexShrink:1},children:[e.jsx(Ve,{time:t,isEditable:o,formatter:O,onTimeChange:he,integrateWithCalendar:m,changeDateOnTextInput:f}),o?e.jsxs(e.Fragment,{children:[e.jsx(Ke,{time:t,onTimeChange:B}),e.jsx(Ye,{history:i,onFavorite:et(i,a),onTimeChange:B})]}):e.jsx(e.Fragment,{})]})]})}function $e(t,n){let r=t.length-n;return t.reduceRight((s,i)=>r>0&&!i.isFavorite?(r--,s):[i,...s],[])}function et(t,n){return(r,s)=>{const a={...t[r],isFavorite:s},o=[...t];o.splice(r,1,a),n(o);const l=o.filter(h=>h.isFavorite);qe(l)}}function tt(t,n,r){return s=>{const i=n&&r?Q(t,s):0;ce(s,i,n).then(()=>{})}}function nt(t,n,r,s,i){return(a,o)=>{const l=_e(t,a,o),h=i?Ne(t,a,o):0;ce(l,h,i).then(()=>{});const d=n.findIndex(x=>x.unit===a&&x.inputValue===o)>=0?n:[...n,{unit:a,inputValue:o,isFavorite:!1}];d.length>s?r($e(d,s)):r(d)}}function rt(t,n,r,s,i){return u.room.onMetadataChange(a=>{const o=a[N];if(o&&t.toString()!==o.time&&o.verificationTimestamp>n){const l=b.parse(o.time);s(l),r(o.verificationTimestamp),u.notification.show("You feel the passage of time... "+l.format(i))}})}function st(t,n,r,s,i,a,o,l){const h=new ResizeObserver(()=>{let g=0;document.getElementById("mainContainer").childNodes.forEach(d=>{g+=d.scrollHeight}),u.action.setHeight(g+1)});return h.observe(document.body),u.room.getMetadata().then(g=>{const d=g[N];d&&t(b.parse(d.time));const x=Je();x&&n(x)}),u.player.getRole().then(g=>{g==="GM"&&r(!0)}),window.addEventListener("storage",function(){s(M()),i(P()),a(L()),o(_()),l(re())}),()=>h.unobserve(document.body)}function G({modalId:t,children:n}){return e.jsx(T,{display:"flex",justifyContent:"center",alignItems:"center",width:"100vw",height:"100vh",onMouseDown:()=>u.modal.close(t),children:e.jsx(Se,{sx:{boxShadow:"none",maxWidth:"400px",maxHeight:"70vh",margin:"16px",overflowY:"auto"},onMouseDown:r=>r.stopPropagation(),children:n})})}function it(){return Ue("1.1.1"),e.jsxs(G,{modalId:ee,children:[e.jsx(E,{title:"OwlClockðŸ¦‰ Changelog",titleTypographyProps:{sx:{fontSize:"1.125rem",fontWeight:"bold",lineHeight:"32px",color:"text.primary"}}}),e.jsx(F,{variant:"middle"}),e.jsxs(R,{children:[e.jsxs(p,{color:"text.secondary",children:["Current version: ",$]}),e.jsx("br",{}),e.jsx(p,{variant:"h5",children:"v1.1.1"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Added changelog page"}),e.jsx("li",{children:"Improved responsiveness on smaller screens"}),e.jsx("li",{children:"Fixed an issue where dragging slider in settings outside the modal closed it"})]}),e.jsx(p,{variant:"h5",children:"v1.1.0"}),e.jsx("ul",{children:e.jsx("li",{children:'Implemented integration with "Calendar!" extension'})}),e.jsx(p,{variant:"h5",children:"v1.0.0"}),e.jsx("ul",{children:e.jsx("li",{children:"Initial release"})})]})]})}function at(){return e.jsxs(G,{modalId:te,children:[e.jsx(E,{title:"OwlClockðŸ¦‰ Information",titleTypographyProps:{sx:{fontSize:"1.125rem",fontWeight:"bold",lineHeight:"32px",color:"text.primary"}}}),e.jsx(F,{variant:"middle"}),e.jsxs(R,{children:[e.jsx(p,{children:"This extension provides a simple way to keep track of in-game time during the day."}),e.jsx("br",{}),e.jsx(p,{children:'You can edit the time directly by editing it in the text field, or by using the "Add" field and "Hours"/"Minutes" buttons. The time will be saved in room data. Only GM can edit the time. You can switch between 24-hour and 12-hour time format in the settings.'}),e.jsx("br",{}),e.jsx(p,{children:'There is an integration with the "Calendar!" extension! You can enable it in "OwlClock" settings. It will change the date when time passes midnight.'}),e.jsx("br",{}),e.jsxs(p,{children:["If there are any bugs, feel free to ",e.jsx("a",{href:"https://github.com/vijexa/owlclock/issues/new",target:"_blank",children:"open an issue"})," on GitHub. Contributions are welcome!"]})]}),e.jsxs(X,{children:[e.jsx(y,{startIcon:e.jsx(Ce,{}),sx:{color:"text.primary",marginLeft:"8px"},href:"https://github.com/vijexa/owlclock",target:"_blank",children:"GitHub"}),e.jsx(T,{marginLeft:"auto",marginRight:"16px",children:e.jsx(p,{color:"text.secondary",children:$})})]})]})}function ot({children:t}){const[n,r]=c.useState(!1);return c.useEffect(()=>{u.isAvailable&&u.onReady(()=>r(!0))},[]),n?e.jsx(e.Fragment,{children:t}):u.isAvailable?e.jsx(T,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(Ie,{color:"secondary"})}):e.jsx(T,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",sx:{backgroundColor:"#0d1117"},children:e.jsxs(p,{fontSize:"1.5rem",color:"#c9d1d9",padding:"16px",children:["This is not a standalone website, but an extension for ",e.jsx("a",{href:"https://owlbear.rodeo",children:"owlbear.rodeo"})," VTT. More info ",e.jsx("a",{href:"https://github.com/vijexa/owlclock",children:"here"}),". Extension manifest ",e.jsx("a",{href:"./manifest.json",children:"here"}),"."]})})}function lt(t){return Ee({palette:t?{mode:t.mode==="LIGHT"?"light":"dark",text:t.text,primary:t.primary,secondary:t.secondary,background:t==null?void 0:t.background}:void 0,shape:{borderRadius:16},components:{MuiButtonBase:{defaultProps:{disableRipple:!0}}}})}function ct({children:t}){const[n,r]=c.useState(void 0);return c.useEffect(()=>{const s=i=>{r(lt(i))};return u.theme.getTheme().then(s),u.theme.onChange(s)},[]),n?e.jsx(we,{theme:n,children:t}):e.jsx(be,{})}const W=H(D)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",gap:"8px"}),Y=H(k)({marginBottom:"8px"}),K=H(Fe)({paddingLeft:"12px",paddingRight:"12px"}),dt=H(X)({justifyContent:"center"});function ut(){const[t]=He(),[n,r]=c.useState(t.get("isGm")==="true"),[s,i]=c.useState(M()),[a,o]=c.useState(P()),[l,h]=c.useState(L()),[g,d]=c.useState(_());c.useEffect(()=>{l||d(!1)},[l]),c.useEffect(()=>{u.player.getRole().then(m=>r(m==="GM"))},[]);function x(m,v){const f=v??j.H24;i(f)}return e.jsxs(G,{modalId:A,children:[e.jsx(E,{title:"OwlClockðŸ¦‰ Settings",titleTypographyProps:{sx:{fontSize:"1.125rem",fontWeight:"bold",lineHeight:"32px",color:"text.primary"}}}),e.jsx(F,{variant:"middle"}),e.jsxs(R,{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs(D,{fullWidth:!0,children:[e.jsx(Y,{children:"Time Format"}),e.jsxs(Oe,{exclusive:!0,size:"small",fullWidth:!0,color:"primary",value:s,onChange:x,children:[e.jsx(K,{value:j.H24,children:"24h"}),e.jsx(K,{value:j.H12,children:"12h"})]})]}),n?e.jsxs(e.Fragment,{children:[e.jsxs(D,{fullWidth:!0,children:[e.jsx(Y,{children:"History Size"}),e.jsx(T,{padding:"0 8px",children:e.jsx(De,{value:a,marks:!0,min:1,max:10,valueLabelDisplay:"auto",onChange:(m,v)=>o(v)})})]}),e.jsxs(W,{fullWidth:!0,children:[e.jsx(z,{checked:l,onChange:m=>h(m.target.checked)}),e.jsx(k,{focused:!1,children:'Integrate with "Calendar!"?'})]}),e.jsxs(W,{fullWidth:!0,disabled:!l,children:[e.jsx(z,{checked:g,onChange:m=>d(m.target.checked)}),e.jsx(k,{focused:!1,children:"Change date on text input?"}),e.jsx(C,{arrow:!0,title:"This option enables date change also on text input. It will assume that if you enter time before current time, you must mean the next day. A hint will appear when applying the time will advance the date. Example: entering 8:00 when current time is 23:00 will trigger date change.",children:e.jsx(I,{children:e.jsx(ke,{})})})]})]}):e.jsx(e.Fragment,{})]}),e.jsx(dt,{children:e.jsx(y,{variant:"outlined",onClick:()=>ht(s,a,l,g),children:"Save"})})]})}function ht(t,n,r,s){Xe(t,n,r,s),u.modal.close(A)}const gt=Re([{path:"/",element:e.jsx(Qe,{})},{path:"/changelog",element:e.jsx(it,{})},{path:"/info",element:e.jsx(at,{})},{path:"/settings",element:e.jsx(ut,{})}]);Ae.createRoot(document.getElementById("root")).render(e.jsx(Me.StrictMode,{children:e.jsx(ot,{children:e.jsx(ct,{children:e.jsx(Pe,{router:gt})})})}));
