import{D as V,d as ae,L as oe,a as ce,C as le,r as l,j as e,B as y,T as Y,b as T,c as C,e as H,I as b,O as h,f as ue,S as de,g as O,h as k,i as K,k as v,F as he,l as me,m as U,n as J,G as ge,o as fe,p as xe,q as pe,s as je,t as I,u as F,v as E,w as Te,x as ye,y as ve,z as Se,A as G,E as Ce,H as Ie,J as we,K as be,R as Fe,M as Ee}from"./vendor-fa3598f3.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=s(i);fetch(i.href,a)}})();const He={hours:60,minutes:1};function Oe(t,n,s){const r=q(n,s);return t.plusMinutes(r)}function q(t,n){return He[t]*n}function ke(t,n,s){const r=oe.of(ce.ofEpochDay(0),t),i=q(n,s),a=r.plusMinutes(i);return le.DAYS.between(r.toLocalDate(),a.toLocalDate())}function X(t,n){return n.isBefore(t)?1:0}var p=(t=>(t.H12="24h",t.H24="12h",t))(p||{});const De=V.ofPattern("h:mm[ ]a").withLocale(ae.Locale.US),Me=V.ofPattern("H:mm");function Ae(t){return t==="12h"?Me:De}function Pe({time:t,isEditable:n,formatter:s,onTimeChange:r,integrateWithCalendar:i,changeDateOnTextInput:a}){const o=t.format(s),[c,u]=l.useState(o),[g,d]=l.useState("");l.useEffect(()=>{u(t.format(s))},[t,s]);function x(f){const S=f.target.value;if(u(S),i&&a)try{X(t,N(S,s))!==0?d("Date will be set to tomorrow"):d("")}catch{d("")}}function m(){try{const f=N(c,s);r(f),d("")}catch{u(t.format(s))}}function j(f){f.key==="Enter"&&f.target.blur()}return e.jsx(e.Fragment,{children:n?e.jsx(y,{display:"flex",justifyContent:"center",alignItems:"center",children:e.jsx(Y,{variant:"standard",value:c,sx:{marginBottom:"16px",width:"210px","& input":{textAlign:"center",fontSize:"3rem"}},onChange:x,onBlur:m,onKeyDown:j,helperText:g})}):e.jsx(T,{variant:"h3",align:"center",color:"text.primary",children:o})})}function N(t,n){const s=t.toUpperCase();return C.parse(s,n)}const Z="dev.vijexa.owlclock/infoModal",D="dev.vijexa.owlclock/settingsModal";function Re({isGm:t}){return e.jsxs(e.Fragment,{children:[e.jsx(H,{title:"OwlClockðŸ¦‰ (dev)",titleTypographyProps:{sx:{fontSize:"1.125rem",fontWeight:"bold",lineHeight:"32px",color:"text.primary"}},action:e.jsxs(e.Fragment,{children:[e.jsx(b,{onClick:()=>h.modal.open({id:Z,url:"/#/info",hidePaper:!0,fullScreen:!0}),children:e.jsx(ue,{})}),e.jsx(b,{onClick:()=>h.modal.open({id:D,url:"/#/settings?isGm="+t,hidePaper:!0,fullScreen:!0}),children:e.jsx(de,{})})]})}),e.jsx(O,{variant:"middle"})]})}function Le({history:t,onTimeChange:n,onFavorite:s}){return e.jsx(e.Fragment,{children:e.jsx(k,{direction:"row",alignItems:"center",justifyContent:"center",flexWrap:"wrap",useFlexGap:!0,spacing:1,children:t.map((r,i)=>e.jsxs(K,{size:"small",variant:"outlined",children:[e.jsxs(v,{sx:{width:"fit-content"},onClick:()=>n(r.unit,r.inputValue),children:[r.inputValue," ",r.unit[0]]}),e.jsx(v,{variant:r.isFavorite?"contained":"outlined",onClick:()=>s(i,!r.isFavorite),children:e.jsx(he,{fontSize:"small"})})]},i))})})}function _e({onTimeChange:t}){const[n,s]=l.useState("1"),[r,i]=l.useState("1"),a=c=>()=>{t(c,parseInt(n))};function o(){const c=parseInt(n);if(isNaN(c)||c===0)s(r);else{const u=c.toString();i(u),s(u)}}return e.jsx(e.Fragment,{children:e.jsxs(k,{direction:"row",alignItems:"center",justifyContent:"center",spacing:1,children:[e.jsx(Y,{id:"outlined-basic",variant:"outlined",type:"number",size:"small",label:"Add",sx:{width:"80px"},value:n,onChange:c=>s(c.target.value),onBlur:o}),e.jsxs(K,{variant:"outlined",children:[e.jsx(v,{onClick:a("hours"),children:"Hours"}),e.jsx(v,{onClick:a("minutes"),children:"Minutes"})]})]})})}const Q="timeFormat",$="historySize",ee="integrateWithCalendar",te="changeDateOnTextInput",ne="favorites";function M(){const t=localStorage.getItem(Q);if(t===p.H12||t===p.H24)return t;{const n=navigator.language;return Intl.DateTimeFormat(n,{hour:"numeric"}).resolvedOptions().hour12?p.H12:p.H24}}function A(){const t=localStorage.getItem($);if(t){const n=parseInt(t);if(!isNaN(n))return n}return 5}function Ge(){const t=localStorage.getItem(ne);if(t)try{const n=JSON.parse(t);if(Array.isArray(n))return n}catch{return[]}return[]}function P(){return localStorage.getItem(ee)==="true"}function R(){return localStorage.getItem(te)==="true"}function Ne(t){localStorage.setItem(ne,JSON.stringify(t))}function Be(t,n,s,r){localStorage.setItem(Q,t),localStorage.setItem($,n.toString()),localStorage.setItem(ee,s.toString()),localStorage.setItem(te,r.toString())}const L="dev.vijexa.owlclock/time",ze="com.battle-system.calendar-integrate/data";function se(t,n,s){const r={[L]:{time:t.toString(),verificationTimestamp:Date.now()}};return s?h.room.setMetadata({...r,[ze]:{Increment:n,Timestamp:Date.now()}}):h.room.setMetadata(r)}function We(){const[t,n]=l.useState(C.parse("00:00")),[s,r]=l.useState(0),[i,a]=l.useState([]),[o,c]=l.useState(!1),[u,g]=l.useState(M()),[d,x]=l.useState(A()),[m,j]=l.useState(P()),[f,S]=l.useState(R());l.useEffect(()=>qe(n,a,c,g,x,j,S),[]);const w=Ae(u);l.useEffect(()=>Je(t,s,r,n,w),[t,s,w]);const _=Ue(t,i,a,d,m),ie=Ke(t,m,f);return e.jsxs(e.Fragment,{children:[e.jsx(Re,{isGm:o}),e.jsxs(k,{direction:"column",spacing:2,sx:{marginTop:"16px"},children:[e.jsx(Pe,{time:t,isEditable:o,formatter:w,onTimeChange:ie,integrateWithCalendar:m,changeDateOnTextInput:f}),o?e.jsxs(e.Fragment,{children:[e.jsx(_e,{time:t,onTimeChange:_}),e.jsx(Le,{history:i,onFavorite:Ye(i,a),onTimeChange:_})]}):e.jsx(e.Fragment,{})]})]})}function Ve(t,n){let s=t.length-n;return t.reduceRight((r,i)=>s>0&&!i.isFavorite?(s--,r):[i,...r],[])}function Ye(t,n){return(s,r)=>{const a={...t[s],isFavorite:r},o=[...t];o.splice(s,1,a),n(o);const c=o.filter(u=>u.isFavorite);Ne(c)}}function Ke(t,n,s){return r=>{const i=n&&s?X(t,r):0;se(r,i,n).then(()=>{})}}function Ue(t,n,s,r,i){return(a,o)=>{const c=Oe(t,a,o),u=i?ke(t,a,o):0;se(c,u,i).then(()=>{});const d=n.findIndex(x=>x.unit===a&&x.inputValue===o)>=0?n:[...n,{unit:a,inputValue:o,isFavorite:!1}];d.length>r?s(Ve(d,r)):s(d)}}function Je(t,n,s,r,i){return h.room.onMetadataChange(a=>{const o=a[L];if(o&&t.toString()!==o.time&&o.verificationTimestamp>n){const c=C.parse(o.time);r(c),s(o.verificationTimestamp),h.notification.show("You feel the passage of time... "+c.format(i))}})}function qe(t,n,s,r,i,a,o){const c=new ResizeObserver(u=>{u.map(g=>{const d=g.contentRect.height+16;h.action.setHeight(d)})});return c.observe(document.body),h.room.getMetadata().then(u=>{const g=u[L];g&&t(C.parse(g.time));const d=Ge();d&&n(d)}),h.player.getRole().then(u=>{u==="GM"&&s(!0)}),window.addEventListener("storage",function(){r(M()),i(A()),a(P()),o(R())}),()=>c.unobserve(document.body)}function re({modalId:t,children:n}){return e.jsx(y,{display:"flex",justifyContent:"center",alignItems:"center",width:"100vw",height:"100vh",onClick:()=>h.modal.close(t),children:e.jsx(me,{sx:{boxShadow:"none",maxWidth:"400px",margin:"16px"},onClick:s=>s.stopPropagation(),children:n})})}function Xe(){return e.jsxs(re,{modalId:Z,children:[e.jsx(H,{title:"OwlClockðŸ¦‰ Information",titleTypographyProps:{sx:{fontSize:"1.125rem",fontWeight:"bold",lineHeight:"32px",color:"text.primary"}}}),e.jsx(O,{variant:"middle"}),e.jsxs(U,{children:[e.jsx(T,{children:"This extension provides a simple way to keep track of in-game time during the day."}),e.jsx("br",{}),e.jsx(T,{children:'You can edit the time directly by editing it in the text field, or by using the "Add" field and "Hours"/"Minutes" buttons. The time will be saved in room data. Only GM can edit the time. You can switch between 24-hour and 12-hour time format in the settings.'}),e.jsx("br",{}),e.jsx(T,{children:'There is an integration with the "Calendar!" extension! You can enable it in "OwlClock" settings. It will change the date when time passes midnight.'}),e.jsx("br",{}),e.jsxs(T,{children:["If there are any bugs, feel free to ",e.jsx("a",{href:"https://github.com/vijexa/owlclock/issues/new",target:"_blank",children:"open an issue"})," on GitHub. Contributions are welcome!"]})]}),e.jsxs(J,{children:[e.jsx(v,{startIcon:e.jsx(ge,{}),sx:{color:"text.primary",marginLeft:"8px"},href:"https://github.com/vijexa/owlclock",target:"_blank",children:"GitHub"}),e.jsx(y,{marginLeft:"auto",marginRight:"16px",children:e.jsxs(T,{color:"text.secondary",children:["v","1.1.0"," (dev build)"]})})]})]})}function Ze({children:t}){const[n,s]=l.useState(!1);return l.useEffect(()=>{h.isAvailable&&h.onReady(()=>s(!0))},[]),n?e.jsx(e.Fragment,{children:t}):h.isAvailable?e.jsx(y,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(fe,{color:"secondary"})}):e.jsx(y,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",sx:{backgroundColor:"#0d1117"},children:e.jsxs(T,{fontSize:"1.5rem",color:"#c9d1d9",padding:"16px",children:["This is not a standalone website, but an extension for ",e.jsx("a",{href:"https://owlbear.rodeo",children:"owlbear.rodeo"})," VTT. More info ",e.jsx("a",{href:"https://github.com/vijexa/owlclock",children:"here"}),". Extension manifest ",e.jsx("a",{href:"./manifest.json",children:"here"}),"."]})})}function Qe(t){return je({palette:t?{mode:t.mode==="LIGHT"?"light":"dark",text:t.text,primary:t.primary,secondary:t.secondary,background:t==null?void 0:t.background}:void 0,shape:{borderRadius:16},components:{MuiButtonBase:{defaultProps:{disableRipple:!0}}}})}function $e({children:t}){const[n,s]=l.useState(void 0);return l.useEffect(()=>{const r=i=>{s(Qe(i))};return h.theme.getTheme().then(r),h.theme.onChange(r)},[]),n?e.jsx(xe,{theme:n,children:t}):e.jsx(pe,{})}const B=I(F)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",gap:"8px"}),z=I(E)({marginBottom:"8px"}),W=I(Te)({paddingLeft:"12px",paddingRight:"12px"}),et=I(J)({justifyContent:"center"});function tt(){const[t]=ye(),[n,s]=l.useState(t.get("isGm")==="true"),[r,i]=l.useState(M()),[a,o]=l.useState(A()),[c,u]=l.useState(P()),[g,d]=l.useState(R());l.useEffect(()=>{c||d(!1)},[c]),l.useEffect(()=>{h.player.getRole().then(m=>s(m==="GM"))},[]);function x(m,j){const f=j??p.H24;i(f)}return e.jsxs(re,{modalId:D,children:[e.jsx(H,{title:"OwlClockðŸ¦‰ Settings",titleTypographyProps:{sx:{fontSize:"1.125rem",fontWeight:"bold",lineHeight:"32px",color:"text.primary"}}}),e.jsx(O,{variant:"middle"}),e.jsxs(U,{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs(F,{fullWidth:!0,children:[e.jsx(z,{children:"Time Format"}),e.jsxs(ve,{exclusive:!0,size:"small",fullWidth:!0,color:"primary",value:r,onChange:x,children:[e.jsx(W,{value:p.H24,children:"24h"}),e.jsx(W,{value:p.H12,children:"12h"})]})]}),n?e.jsxs(e.Fragment,{children:[e.jsxs(F,{fullWidth:!0,children:[e.jsx(z,{children:"History Size"}),e.jsx(y,{padding:"0 8px",children:e.jsx(Se,{value:a,marks:!0,min:1,max:10,valueLabelDisplay:"auto",onChange:(m,j)=>o(j)})})]}),e.jsxs(B,{fullWidth:!0,children:[e.jsx(G,{checked:c,onChange:m=>u(m.target.checked)}),e.jsx(E,{focused:!1,children:'Integrate with "Calendar!"?'})]}),e.jsxs(B,{fullWidth:!0,disabled:!c,children:[e.jsx(G,{checked:g,onChange:m=>d(m.target.checked)}),e.jsx(E,{focused:!1,children:"Change date on text input?"}),e.jsx(Ce,{arrow:!0,title:"This option enables date change also on text input. It will assume that if you enter time before current time, you must mean the next day. A hint will appear when applying the time will advance the date. Example: entering 8:00 when current time is 23:00 will trigger date change.",children:e.jsx(b,{children:e.jsx(Ie,{})})})]})]}):e.jsx(e.Fragment,{})]}),e.jsx(et,{children:e.jsx(v,{variant:"outlined",onClick:()=>nt(r,a,c,g),children:"Save"})})]})}function nt(t,n,s,r){Be(t,n,s,r),h.modal.close(D)}const st=we([{path:"/",element:e.jsx(We,{})},{path:"/info",element:e.jsx(Xe,{})},{path:"/settings",element:e.jsx(tt,{})}]);be.createRoot(document.getElementById("root")).render(e.jsx(Fe.StrictMode,{children:e.jsx(Ze,{children:e.jsx($e,{children:e.jsx(Ee,{router:st})})})}));
